"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(b,c){if(b){if("string"==typeof b)return _arrayLikeToArray(b,c);var a={}.toString.call(b).slice(8,-1);return"Object"===a&&b.constructor&&(a=b.constructor.name),"Map"===a||"Set"===a?Array.from(b):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(b,c):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(b,c){(null==c||c>b.length)&&(c=b.length);for(var d=0,f=Array(c);d<c;d++)f[d]=b[d];return f}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return(b=_toPropertyKey(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"==typeof b?b:b+""}function _toPrimitive(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}var _require=require("./RequestValidator"),checkRequest=_require.checkRequest,MongooseBreadError=require("./mongooseBreadError");function parseSelect(a){var b=[];return a.select&&"string"==typeof a.select&&(b=Array.from(new Set(a.select.split(",")))),b.join(" ")}function parseQuery(a,b,c){return a.query?a.query:a.search?parseSearchFilter(a,b):parseQueryFilter(a,c)}function parseSearchFilter(a,b){var c=b.searchableFields;if(!Array.isArray(c)||!c.length)throw new MongooseBreadError({message:"Search is not availabe for this resource",details:"To enable search provide an \"searchableFields\" Array to the plugin registration options",statusCode:404,issuer:`MongooseBreadHelper parseSearchFilter`});if(b.enableAtlasSearch&&b.atlasSearchIndex){var d={$search:{index:b.atlasSearchIndex,text:{query:a.search,path:c}}};return JSON.stringify(d)}if(a.search&&"string"==typeof a.search){var e=a.search.split(" ").reduce(function(a,b){var d=c.map(function(a){return{[a]:{$regex:b,$options:"i"}}});return a.concat(d)},[]);return JSON.stringify({$or:e})}}function parseQueryFilter(a,b){var c=Object.keys(b.paths),d=Object.keys(a).reduce(function(a,b){return c.includes(b)||delete a[b],a},_objectSpread({},a));return JSON.stringify(d).replace(/\b(gt|gte|lt|lte|in|eq|ne)\b/g,function(a){return`$${a}`})}function parseProjection(a,b){return a.projection?a.projection:Array.isArray(b.blacklistedFields)?b.blacklistedFields.reduce(function(a,b){return _objectSpread(_objectSpread({},a),{},{[b]:0})},{}):{}}function parseLimit(a,b){var c=Math.min,d=b.maxPageSize,e=b.defaultPageSize,f=e;return a.limit&&("string"==typeof a.limit&&(f=parseInt(a.limit)),"number"==typeof a.limit&&(f=a.limit)),c(f,d)}function parseRequestParamsId(a,b,c){var d=b.paramsIdKey,e=c.issuer;return checkRequest(a).paramsIdIsValid(d,e).bodyIsNotAnArray(e),a.params[d]}function parseEditRequestBody(a,b,c){var d=b.bulkDocsKey,e=c.issuer;return checkRequest(a).hasBody(e).hasBodyProperty(d,e).bodyPropertyIsArray(d,e),a.body[d].reduce(function(a,b){return Object.assign(a,b)},{})}function parseAddRequestBody(a,b,c){var d=b.bulkDocsKey,e=c.issuer;return checkRequest(a).hasBody(e).hasBodyProperty(d,e).bodyPropertyIsArray(d,e),_toConsumableArray(a.body[d])}function parseRequestBodyIds(a,b,c){var d=b.bulkIdsKey,e=c.issuer;checkRequest(a).hasBody(e).hasBodyProperty(d,e).bodyPropertyIsArray(d,e).bodyPropertyArrayIncludesOnlyObjectIds(d,e);var f=_toConsumableArray(a.body[d]);return delete a.body[d],f}function parseRequestUserIdPath(a,b){try{var c=b.requestUserIdPath,d=c.split(".").reduce(function(a,b){if(b in a)return a[b];throw new Error(`requestUserIdPathError: could not resolve request.${c} - @key: ${b} - check softDeleteOptions.requestUserIdPath to match a path to userId:ObjectId`)},a);return d}catch(c){if(c instanceof Error)throw new MongooseBreadError({message:c.message,details:JSON.stringify({request:a,options:b}),issuer:`MongooseBreadHelper parseRequestUserIdPath`});throw c}}module.exports={parseSelect,parseQuery,parseSearchFilter,parseQueryFilter,parseProjection,parseLimit,parseRequestParamsId,parseEditRequestBody,parseAddRequestBody,parseRequestBodyIds,parseRequestUserIdPath};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1aXJlIiwiY2hlY2tSZXF1ZXN0IiwiX3JlcXVpcmUiLCJNb25nb29zZUJyZWFkRXJyb3IiLCJwYXJzZVNlbGVjdCIsInF1ZXJ5IiwiZmllbGRzIiwic2VsZWN0IiwiQXJyYXkiLCJmcm9tIiwiU2V0Iiwic3BsaXQiLCJqb2luIiwicGFyc2VRdWVyeSIsIm9wdGlvbnMiLCJzY2hlbWEiLCJzZWFyY2giLCJwYXJzZVNlYXJjaEZpbHRlciIsInBhcnNlUXVlcnlGaWx0ZXIiLCJzZWFyY2hhYmxlRmllbGRzIiwiaXNBcnJheSIsImxlbmd0aCIsIm1lc3NhZ2UiLCJkZXRhaWxzIiwic3RhdHVzQ29kZSIsImlzc3VlciIsImVuYWJsZUF0bGFzU2VhcmNoIiwiYXRsYXNTZWFyY2hJbmRleCIsInNlYXJjaFF1ZXJ5IiwiJHNlYXJjaCIsImluZGV4IiwidGV4dCIsInBhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwicmVkdWNlIiwiZmllbGRRdWVyaWVzQ29sbGVjdGlvbiIsInNlYXJjaFRlcm0iLCJmaWVsZFF1ZXJpZXMiLCJtYXAiLCJmaWVsZCIsIiRyZWdleCIsIiRvcHRpb25zIiwiY29uY2F0IiwiJG9yIiwia2V5cyIsIk9iamVjdCIsInBhdGhzIiwic2FuaXRpemVkRmlsdGVyIiwiZmlsdGVyIiwia2V5IiwiaW5jbHVkZXMiLCJfb2JqZWN0U3ByZWFkIiwicmVwbGFjZSIsIm0iLCJwYXJzZVByb2plY3Rpb24iLCJwcm9qZWN0aW9uIiwiYmxhY2tsaXN0ZWRGaWVsZHMiLCJvYmoiLCJwYXJzZUxpbWl0IiwiYyIsIk1hdGgiLCJtaW4iLCJtYXhQYWdlU2l6ZSIsImRlZmF1bHRQYWdlU2l6ZSIsImxpbWl0IiwicGFyc2VJbnQiLCJwYXJzZVJlcXVlc3RQYXJhbXNJZCIsInJlcXVlc3QiLCJwbHVnaW5PcHRpb25zIiwiZXJyb3JPcHRpb25zIiwicGFyYW1zSWRLZXkiLCJwYXJhbXNJZElzVmFsaWQiLCJib2R5SXNOb3RBbkFycmF5IiwicGFyYW1zIiwicGFyc2VFZGl0UmVxdWVzdEJvZHkiLCJidWxrRG9jc0tleSIsImhhc0JvZHkiLCJoYXNCb2R5UHJvcGVydHkiLCJib2R5UHJvcGVydHlJc0FycmF5IiwiYm9keSIsImFjYyIsImRvYyIsImFzc2lnbiIsInBhcnNlQWRkUmVxdWVzdEJvZHkiLCJfdG9Db25zdW1hYmxlQXJyYXkiLCJwYXJzZVJlcXVlc3RCb2R5SWRzIiwiYnVsa0lkc0tleSIsImJvZHlQcm9wZXJ0eUFycmF5SW5jbHVkZXNPbmx5T2JqZWN0SWRzIiwiYm9keUlkcyIsInBhcnNlUmVxdWVzdFVzZXJJZFBhdGgiLCJyZXF1ZXN0VXNlcklkUGF0aCIsInVzZXJJZCIsInVzZXIiLCJFcnJvciIsImVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9QYXJzZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBTY2hlbWEgfSBmcm9tIFwibW9uZ29vc2VcIjtcblxuY29uc3QgeyBjaGVja1JlcXVlc3QgfSA9IHJlcXVpcmUoXCIuL1JlcXVlc3RWYWxpZGF0b3JcIik7XG5jb25zdCBNb25nb29zZUJyZWFkRXJyb3IgPSByZXF1aXJlKFwiLi9tb25nb29zZUJyZWFkRXJyb3JcIik7XG5cbmZ1bmN0aW9uIHBhcnNlU2VsZWN0KHF1ZXJ5OiBFeHByZXNzUXVlcnkpIHtcblx0bGV0IGZpZWxkczogc3RyaW5nW10gPSBbXTtcblx0aWYgKHF1ZXJ5LnNlbGVjdCAmJiB0eXBlb2YgcXVlcnkuc2VsZWN0ID09IFwic3RyaW5nXCIpIHtcblx0XHRmaWVsZHMgPSBBcnJheS5mcm9tKG5ldyBTZXQocXVlcnkuc2VsZWN0LnNwbGl0KFwiLFwiKSkpO1xuXHR9XG5cdHJldHVybiBmaWVsZHMuam9pbihcIiBcIik7XG59XG5cbmZ1bmN0aW9uIHBhcnNlUXVlcnkocXVlcnk6IEV4cHJlc3NRdWVyeSwgb3B0aW9uczogTW9uZ29vc2VCcmVhZE9wdGlvbnMsIHNjaGVtYTogU2NoZW1hKSB7XG5cdGlmIChxdWVyeS5xdWVyeSkgcmV0dXJuIHF1ZXJ5LnF1ZXJ5O1xuXG5cdHJldHVybiBxdWVyeS5zZWFyY2ggPyBwYXJzZVNlYXJjaEZpbHRlcihxdWVyeSwgb3B0aW9ucykgOiBwYXJzZVF1ZXJ5RmlsdGVyKHF1ZXJ5LCBzY2hlbWEpO1xufVxuXG5mdW5jdGlvbiBwYXJzZVNlYXJjaEZpbHRlcihxdWVyeTogRXhwcmVzc1F1ZXJ5LCBvcHRpb25zOiBNb25nb29zZUJyZWFkT3B0aW9ucykge1xuXHRjb25zdCB7IHNlYXJjaGFibGVGaWVsZHMgfSA9IG9wdGlvbnM7XG5cdGlmICghQXJyYXkuaXNBcnJheShzZWFyY2hhYmxlRmllbGRzKSB8fCAhc2VhcmNoYWJsZUZpZWxkcy5sZW5ndGgpIHtcblx0XHR0aHJvdyBuZXcgTW9uZ29vc2VCcmVhZEVycm9yKHtcblx0XHRcdG1lc3NhZ2U6IFwiU2VhcmNoIGlzIG5vdCBhdmFpbGFiZSBmb3IgdGhpcyByZXNvdXJjZVwiLFxuXHRcdFx0ZGV0YWlsczogJ1RvIGVuYWJsZSBzZWFyY2ggcHJvdmlkZSBhbiBcInNlYXJjaGFibGVGaWVsZHNcIiBBcnJheSB0byB0aGUgcGx1Z2luIHJlZ2lzdHJhdGlvbiBvcHRpb25zJyxcblx0XHRcdHN0YXR1c0NvZGU6IDQwNCxcblx0XHRcdGlzc3VlcjogYE1vbmdvb3NlQnJlYWRIZWxwZXIgcGFyc2VTZWFyY2hGaWx0ZXJgLFxuXHRcdH0pO1xuXHR9XG5cblx0aWYgKG9wdGlvbnMuZW5hYmxlQXRsYXNTZWFyY2ggJiYgb3B0aW9ucy5hdGxhc1NlYXJjaEluZGV4KSB7XG5cdFx0Y29uc3Qgc2VhcmNoUXVlcnkgPSB7XG5cdFx0XHQkc2VhcmNoOiB7XG5cdFx0XHRcdGluZGV4OiBvcHRpb25zLmF0bGFzU2VhcmNoSW5kZXgsXG5cdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRxdWVyeTogcXVlcnkuc2VhcmNoLFxuXHRcdFx0XHRcdHBhdGg6IHNlYXJjaGFibGVGaWVsZHMsXG5cdFx0XHRcdH0sXG5cdFx0XHR9LFxuXHRcdH07XG5cdFx0cmV0dXJuIEpTT04uc3RyaW5naWZ5KHNlYXJjaFF1ZXJ5KTtcblx0fSBlbHNlIGlmIChxdWVyeS5zZWFyY2ggJiYgdHlwZW9mIHF1ZXJ5LnNlYXJjaCA9PSBcInN0cmluZ1wiKSB7XG5cdFx0Y29uc3Qgc2VhcmNoUXVlcnkgPSBxdWVyeS5zZWFyY2hcblx0XHRcdC5zcGxpdChcIiBcIilcblx0XHRcdC5yZWR1Y2UoKGZpZWxkUXVlcmllc0NvbGxlY3Rpb246IFJlY29yZDxzdHJpbmcsIGFueT5bXSwgc2VhcmNoVGVybTogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGZpZWxkUXVlcmllcyA9IHNlYXJjaGFibGVGaWVsZHMubWFwKChmaWVsZCkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiB7IFtmaWVsZF06IHsgJHJlZ2V4OiBzZWFyY2hUZXJtLCAkb3B0aW9uczogXCJpXCIgfSB9O1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0cmV0dXJuIGZpZWxkUXVlcmllc0NvbGxlY3Rpb24uY29uY2F0KGZpZWxkUXVlcmllcyk7XG5cdFx0XHR9LCBbXSk7XG5cblx0XHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkoeyAkb3I6IHNlYXJjaFF1ZXJ5IH0pO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHBhcnNlUXVlcnlGaWx0ZXIocXVlcnk6IEV4cHJlc3NRdWVyeSwgc2NoZW1hOiBTY2hlbWEpIHtcblx0Y29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHNjaGVtYS5wYXRocyk7XG5cdGNvbnN0IHNhbml0aXplZEZpbHRlciA9IE9iamVjdC5rZXlzKHF1ZXJ5KS5yZWR1Y2UoXG5cdFx0KGZpbHRlciwga2V5KSA9PiB7XG5cdFx0XHRpZiAoIWtleXMuaW5jbHVkZXMoa2V5KSkgZGVsZXRlIGZpbHRlcltrZXldO1xuXHRcdFx0cmV0dXJuIGZpbHRlcjtcblx0XHR9LFxuXHRcdHsgLi4ucXVlcnkgfVxuXHQpO1xuXHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkoc2FuaXRpemVkRmlsdGVyKS5yZXBsYWNlKC9cXGIoZ3R8Z3RlfGx0fGx0ZXxpbnxlcXxuZSlcXGIvZywgKG0pID0+IGAkJHttfWApO1xufVxuXG5mdW5jdGlvbiBwYXJzZVByb2plY3Rpb24ocXVlcnk6IEV4cHJlc3NRdWVyeSwgb3B0aW9uczogTW9uZ29vc2VCcmVhZE9wdGlvbnMpIHtcblx0aWYgKHF1ZXJ5LnByb2plY3Rpb24pIHJldHVybiBxdWVyeS5wcm9qZWN0aW9uO1xuXHRpZiAoIUFycmF5LmlzQXJyYXkob3B0aW9ucy5ibGFja2xpc3RlZEZpZWxkcykpIHJldHVybiB7fTtcblx0cmV0dXJuIG9wdGlvbnMuYmxhY2tsaXN0ZWRGaWVsZHMucmVkdWNlKChvYmosIGZpZWxkKSA9PiAoeyAuLi5vYmosIFtmaWVsZF06IDAgfSksIHt9KTtcbn1cblxuZnVuY3Rpb24gcGFyc2VMaW1pdChxdWVyeTogRXhwcmVzc1F1ZXJ5LCBvcHRpb25zOiBNb25nb29zZUJyZWFkT3B0aW9ucykge1xuXHRjb25zdCB7IG1heFBhZ2VTaXplLCBkZWZhdWx0UGFnZVNpemUgfSA9IG9wdGlvbnM7XG5cdGxldCBsaW1pdCA9IGRlZmF1bHRQYWdlU2l6ZTtcblx0aWYgKHF1ZXJ5LmxpbWl0KSB7XG5cdFx0aWYgKHR5cGVvZiBxdWVyeS5saW1pdCA9PSBcInN0cmluZ1wiKSBsaW1pdCA9IHBhcnNlSW50KHF1ZXJ5LmxpbWl0KTtcblx0XHRpZiAodHlwZW9mIHF1ZXJ5LmxpbWl0ID09IFwibnVtYmVyXCIpIGxpbWl0ID0gcXVlcnkubGltaXQ7XG5cdH1cblx0cmV0dXJuIE1hdGgubWluKGxpbWl0LCBtYXhQYWdlU2l6ZSk7XG59XG5cbmZ1bmN0aW9uIHBhcnNlUmVxdWVzdFBhcmFtc0lkKFxuXHRyZXF1ZXN0OiBSZXF1ZXN0LFxuXHRwbHVnaW5PcHRpb25zOiBNb25nb29zZUJyZWFkT3B0aW9ucyxcblx0ZXJyb3JPcHRpb25zOiBNb25nb29zZUJyZWFkRXJyb3JPcHRpb25zXG4pIHtcblx0Y29uc3QgeyBwYXJhbXNJZEtleSB9ID0gcGx1Z2luT3B0aW9ucztcblx0Y29uc3QgeyBpc3N1ZXIgfSA9IGVycm9yT3B0aW9ucztcblx0Y2hlY2tSZXF1ZXN0KHJlcXVlc3QpLnBhcmFtc0lkSXNWYWxpZChwYXJhbXNJZEtleSwgaXNzdWVyKS5ib2R5SXNOb3RBbkFycmF5KGlzc3Vlcik7XG5cdHJldHVybiByZXF1ZXN0LnBhcmFtc1twYXJhbXNJZEtleV07XG59XG5cbmZ1bmN0aW9uIHBhcnNlRWRpdFJlcXVlc3RCb2R5KFxuXHRyZXF1ZXN0OiBSZXF1ZXN0LFxuXHRwbHVnaW5PcHRpb25zOiBNb25nb29zZUJyZWFkT3B0aW9ucyxcblx0ZXJyb3JPcHRpb25zOiBNb25nb29zZUJyZWFkRXJyb3JPcHRpb25zXG4pIHtcblx0Y29uc3QgeyBidWxrRG9jc0tleSB9ID0gcGx1Z2luT3B0aW9ucztcblx0Y29uc3QgeyBpc3N1ZXIgfSA9IGVycm9yT3B0aW9ucztcblxuXHRjaGVja1JlcXVlc3QocmVxdWVzdCkuaGFzQm9keShpc3N1ZXIpLmhhc0JvZHlQcm9wZXJ0eShidWxrRG9jc0tleSwgaXNzdWVyKS5ib2R5UHJvcGVydHlJc0FycmF5KGJ1bGtEb2NzS2V5LCBpc3N1ZXIpO1xuXG5cdC8vIG1lcmdlIGVkaXQgZG9jdW1lbnRzIHRvIHNpbmdsZSBPYmplY3Rcblx0cmV0dXJuIHJlcXVlc3QuYm9keVtidWxrRG9jc0tleV0ucmVkdWNlKChhY2M6IFJlY29yZDxzdHJpbmcsIGFueT4sIGRvYzogUmVjb3JkPHN0cmluZywgYW55PikgPT4ge1xuXHRcdHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgZG9jKTtcblx0fSwge30pO1xufVxuXG5mdW5jdGlvbiBwYXJzZUFkZFJlcXVlc3RCb2R5KFxuXHRyZXF1ZXN0OiBSZXF1ZXN0LFxuXHRwbHVnaW5PcHRpb25zOiBNb25nb29zZUJyZWFkT3B0aW9ucyxcblx0ZXJyb3JPcHRpb25zOiBNb25nb29zZUJyZWFkRXJyb3JPcHRpb25zXG4pIHtcblx0Y29uc3QgeyBidWxrRG9jc0tleSB9ID0gcGx1Z2luT3B0aW9ucztcblx0Y29uc3QgeyBpc3N1ZXIgfSA9IGVycm9yT3B0aW9ucztcblxuXHRjaGVja1JlcXVlc3QocmVxdWVzdCkuaGFzQm9keShpc3N1ZXIpLmhhc0JvZHlQcm9wZXJ0eShidWxrRG9jc0tleSwgaXNzdWVyKS5ib2R5UHJvcGVydHlJc0FycmF5KGJ1bGtEb2NzS2V5LCBpc3N1ZXIpO1xuXG5cdHJldHVybiBbLi4ucmVxdWVzdC5ib2R5W2J1bGtEb2NzS2V5XV07XG59XG5cbmZ1bmN0aW9uIHBhcnNlUmVxdWVzdEJvZHlJZHMoXG5cdHJlcXVlc3Q6IFJlcXVlc3QsXG5cdHBsdWdpbk9wdGlvbnM6IE1vbmdvb3NlQnJlYWRPcHRpb25zLFxuXHRlcnJvck9wdGlvbnM6IE1vbmdvb3NlQnJlYWRFcnJvck9wdGlvbnNcbikge1xuXHRjb25zdCB7IGJ1bGtJZHNLZXkgfSA9IHBsdWdpbk9wdGlvbnM7XG5cdGNvbnN0IHsgaXNzdWVyIH0gPSBlcnJvck9wdGlvbnM7XG5cblx0Y2hlY2tSZXF1ZXN0KHJlcXVlc3QpXG5cdFx0Lmhhc0JvZHkoaXNzdWVyKVxuXHRcdC5oYXNCb2R5UHJvcGVydHkoYnVsa0lkc0tleSwgaXNzdWVyKVxuXHRcdC5ib2R5UHJvcGVydHlJc0FycmF5KGJ1bGtJZHNLZXksIGlzc3Vlcilcblx0XHQuYm9keVByb3BlcnR5QXJyYXlJbmNsdWRlc09ubHlPYmplY3RJZHMoYnVsa0lkc0tleSwgaXNzdWVyKTtcblxuXHRjb25zdCBib2R5SWRzID0gWy4uLnJlcXVlc3QuYm9keVtidWxrSWRzS2V5XV07XG5cdGRlbGV0ZSByZXF1ZXN0LmJvZHlbYnVsa0lkc0tleV07XG5cblx0cmV0dXJuIGJvZHlJZHM7XG59XG5cbmZ1bmN0aW9uIHBhcnNlUmVxdWVzdFVzZXJJZFBhdGgocmVxdWVzdDogUmVxdWVzdCwgb3B0aW9uczogeyByZXF1ZXN0VXNlcklkUGF0aDogc3RyaW5nIH0pIHtcblx0dHJ5IHtcblx0XHRjb25zdCB7IHJlcXVlc3RVc2VySWRQYXRoIH0gPSBvcHRpb25zO1xuXHRcdGNvbnN0IHVzZXJJZCA9IHJlcXVlc3RVc2VySWRQYXRoLnNwbGl0KFwiLlwiKS5yZWR1Y2UoKHVzZXI6IFJlY29yZDxzdHJpbmcsIGFueT4sIGtleTogc3RyaW5nKSA9PiB7XG5cdFx0XHRpZiAoa2V5IGluIHVzZXIpIHJldHVybiB1c2VyW2tleV07XG5cdFx0XHRjb25zdCBlcnJvck1lc3NhZ2UgPSBgcmVxdWVzdFVzZXJJZFBhdGhFcnJvcjogY291bGQgbm90IHJlc29sdmUgcmVxdWVzdC4ke3JlcXVlc3RVc2VySWRQYXRofSAtIEBrZXk6ICR7a2V5fSAtIGNoZWNrIHNvZnREZWxldGVPcHRpb25zLnJlcXVlc3RVc2VySWRQYXRoIHRvIG1hdGNoIGEgcGF0aCB0byB1c2VySWQ6T2JqZWN0SWRgO1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7XG5cdFx0fSwgcmVxdWVzdCk7XG5cdFx0cmV0dXJuIHVzZXJJZDtcblx0fSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcblx0XHRpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IE1vbmdvb3NlQnJlYWRFcnJvcih7XG5cdFx0XHRcdG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG5cdFx0XHRcdGRldGFpbHM6IEpTT04uc3RyaW5naWZ5KHsgcmVxdWVzdCwgb3B0aW9ucyB9KSxcblx0XHRcdFx0aXNzdWVyOiBgTW9uZ29vc2VCcmVhZEhlbHBlciBwYXJzZVJlcXVlc3RVc2VySWRQYXRoYCxcblx0XHRcdH0pO1xuXHRcdH1cblx0XHR0aHJvdyBlcnJvcjtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0cGFyc2VTZWxlY3QsXG5cdHBhcnNlUXVlcnksXG5cdHBhcnNlU2VhcmNoRmlsdGVyLFxuXHRwYXJzZVF1ZXJ5RmlsdGVyLFxuXHRwYXJzZVByb2plY3Rpb24sXG5cdHBhcnNlTGltaXQsXG5cdHBhcnNlUmVxdWVzdFBhcmFtc0lkLFxuXHRwYXJzZUVkaXRSZXF1ZXN0Qm9keSxcblx0cGFyc2VBZGRSZXF1ZXN0Qm9keSxcblx0cGFy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