"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(b,c){if(b){if("string"==typeof b)return _arrayLikeToArray(b,c);var a={}.toString.call(b).slice(8,-1);return"Object"===a&&b.constructor&&(a=b.constructor.name),"Map"===a||"Set"===a?Array.from(b):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(b,c):void 0}}function _arrayLikeToArray(b,c){(null==c||c>b.length)&&(c=b.length);for(var d=0,f=Array(c);d<c;d++)f[d]=b[d];return f}function _iterableToArrayLimit(b,c){var d=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=d){var g,h,j,k,l=[],a=!0,m=!1;try{if(j=(d=d.call(b)).next,0===c){if(Object(d)!==d)return;a=!1}else for(;!(a=(g=j.call(d)).done)&&(l.push(g.value),l.length!==c);a=!0);}catch(a){m=!0,h=a}finally{try{if(!a&&null!=d.return&&(k=d.return(),Object(k)!==k))return}finally{if(m)throw h}}return l}}function _arrayWithHoles(a){if(Array.isArray(a))return a}var toBreadErrorFactory=require("./toBreadErrorFactory");function softDeleteFactory(a){var b=a.softDeleteOptions.deletedBy,c=a.customLabels,d=c.docs,e=c.acknowledged,f=c.modifiedCount,g=function(a){var b,c,g=_slicedToArray(a,2),h=g[0],i=g[1];return{[d]:i,[e]:null===(b=h.acknowledged)||void 0===b||b,[f]:null!==(c=h.modifiedCount)&&void 0!==c?c:h.nModified}},h=toBreadErrorFactory({[d]:[],[e]:!1,[f]:0});return function(a){var c=this,d=a.userId,e=a.query,f=this.findWithDeleted(e,{_id:1});return f.then(function mergeSoftDeleteAndDocs(a){return Promise.all([b&&d?c.delete(e,d).orFail():c.delete(e).orFail(),Promise.resolve(a)])}).then(g).catch(h)}}module.exports=softDeleteFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0b0JyZWFkRXJyb3JGYWN0b3J5IiwicmVxdWlyZSIsInNvZnREZWxldGVGYWN0b3J5IiwicGx1Z2luT3B0aW9ucyIsImRlbGV0ZWRCeSIsInNvZnREZWxldGVPcHRpb25zIiwiYyIsImN1c3RvbUxhYmVscyIsImRvY3MiLCJhY2tub3dsZWRnZWQiLCJtb2RpZmllZENvdW50IiwidG9CcmVhZFJlc3VsdCIsImEiLCJiIiwiZyIsIl9zbGljZWRUb0FycmF5IiwicmVzdWx0IiwiX2RvY3MiLCJuTW9kaWZpZWQiLCJ0b0JyZWFkRXJyb3IiLCJvcHRpb25zIiwidXNlcklkIiwicXVlcnkiLCJmaW5kUXVlcnkiLCJmaW5kV2l0aERlbGV0ZWQiLCJfaWQiLCJ0aGVuIiwibWVyZ2VTb2Z0RGVsZXRlQW5kRG9jcyIsIlByb21pc2UiLCJhbGwiLCJkZWxldGUiLCJvckZhaWwiLCJyZXNvbHZlIiwiY2F0Y2giLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2ZhY3Rvcmllcy9zb2Z0RGVsZXRlRmFjdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb2RlbCwgUXVlcnkgfSBmcm9tIFwibW9uZ29vc2VcIjtcbmltcG9ydCB7IE1vbmdvb3NlQnJlYWRPcHRpb25zLCBNb25nb29zZUJyZWFkU29mdERlbGV0ZU9wdGlvbnMgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IFNvZnREZWxldGVNb2RlbCB9IGZyb20gXCJtb25nb29zZS1kZWxldGVcIjtcblxuY29uc3QgdG9CcmVhZEVycm9yRmFjdG9yeSA9IHJlcXVpcmUoXCIuL3RvQnJlYWRFcnJvckZhY3RvcnlcIik7XG5cbmZ1bmN0aW9uIHNvZnREZWxldGVGYWN0b3J5KHBsdWdpbk9wdGlvbnM6IE1vbmdvb3NlQnJlYWRPcHRpb25zKSB7XG5cdGNvbnN0IHsgZGVsZXRlZEJ5IH0gPSBwbHVnaW5PcHRpb25zLnNvZnREZWxldGVPcHRpb25zO1xuXHRjb25zdCB7IGRvY3MsIGFja25vd2xlZGdlZCwgbW9kaWZpZWRDb3VudCB9ID0gcGx1Z2luT3B0aW9ucy5jdXN0b21MYWJlbHM7XG5cdGNvbnN0IHRvQnJlYWRSZXN1bHQgPSAoW3Jlc3VsdCwgX2RvY3NdOiBbYW55LCBhbnlbXV0pID0+ICh7XG5cdFx0W2RvY3NdOiBfZG9jcyxcblx0XHRbYWNrbm93bGVkZ2VkXTogcmVzdWx0LmFja25vd2xlZGdlZCA/PyB0cnVlLFxuXHRcdFttb2RpZmllZENvdW50XTogcmVzdWx0Lm1vZGlmaWVkQ291bnQgPz8gcmVzdWx0Lm5Nb2RpZmllZCxcblx0fSk7XG5cdGNvbnN0IHRvQnJlYWRFcnJvciA9IHRvQnJlYWRFcnJvckZhY3Rvcnkoe1xuXHRcdFtkb2NzXTogW10sXG5cdFx0W2Fja25vd2xlZGdlZF06IGZhbHNlLFxuXHRcdFttb2RpZmllZENvdW50XTogMCxcblx0fSk7XG5cblx0cmV0dXJuIGZ1bmN0aW9uIHNvZnREZWxldGUodGhpczogTW9kZWw8YW55PiAmIFNvZnREZWxldGVNb2RlbDxhbnk+LCBvcHRpb25zOk1vbmdvb3NlQnJlYWRTb2Z0RGVsZXRlT3B0aW9ucykge1xuXHRcdGNvbnN0IHsgdXNlcklkLCBxdWVyeSB9ID0gb3B0aW9ucztcblxuXHRcdGNvbnN0IG1lcmdlU29mdERlbGV0ZUFuZERvY3MgPSAoX2RvY3M6IGFueSkgPT5cblx0XHRcdFByb21pc2UuYWxsKFtcblx0XHRcdFx0ZGVsZXRlZEJ5ICYmIHVzZXJJZCA/IHRoaXMuZGVsZXRlKHF1ZXJ5LCB1c2VySWQpLm9yRmFpbCgpIDogdGhpcy5kZWxldGUocXVlcnkpLm9yRmFpbCgpLFxuXHRcdFx0XHRQcm9taXNlLnJlc29sdmUoX2RvY3MpLFxuXHRcdFx0XSk7XG5cblx0XHRjb25zdCBmaW5kUXVlcnkgPSB0aGlzLmZpbmRXaXRoRGVsZXRlZChxdWVyeSwgeyBfaWQ6IDEgfSkgYXMgUXVlcnk8YW55LCBhbnk+O1xuXG5cdFx0cmV0dXJuIGZpbmRRdWVyeS50aGVuKG1lcmdlU29mdERlbGV0ZUFuZERvY3MpLnRoZW4odG9CcmVhZFJlc3VsdCkuY2F0Y2godG9CcmVhZEVycm9yKTtcblx0fTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBzb2Z0RGVsZXRlRmFjdG9yeTtcbiJdLCJtYXBwaW5ncyI6IjR1Q0FJQSxHQUFNLENBQUFBLG1CQUFtQixDQUFHQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FFNUQsUUFBUyxDQUFBQyxpQkFBaUJBLENBQUNDLENBQW1DLENBQUUsSUFDdkQsQ0FBQUMsQ0FBUyxDQUFLRCxDQUFhLENBQUNFLGlCQUFpQixDQUE3Q0QsU0FBUyxDQUFBRSxDQUFBLENBQzZCSCxDQUFhLENBQUNJLFlBQVksQ0FBaEVDLENBQUksQ0FBQUYsQ0FBQSxDQUFKRSxJQUFJLENBQUVDLENBQVksQ0FBQUgsQ0FBQSxDQUFaRyxZQUFZLENBQUVDLENBQWEsQ0FBQUosQ0FBQSxDQUFiSSxhQUFhLENBQ25DQyxDQUFhLENBQUcsUUFBQUEsQ0FBQUMsQ0FBQSxNQUFBQyxDQUFBLENBQUFQLENBQUEsQ0FBQVEsQ0FBQSxDQUFBQyxjQUFBLENBQUFILENBQUEsSUFBRUksQ0FBTSxDQUFBRixDQUFBLElBQUVHLENBQUssQ0FBQUgsQ0FBQSxVQUFxQixDQUN6RCxDQUFDTixDQUFJLEVBQUdTLENBQUssQ0FDYixDQUFDUixDQUFZLFVBQUFJLENBQUEsQ0FBR0csQ0FBTSxDQUFDUCxZQUFZLFlBQUFJLENBQUEsRUFBQUEsQ0FBUSxDQUMzQyxDQUFDSCxDQUFhLFVBQUFKLENBQUEsQ0FBR1UsQ0FBTSxDQUFDTixhQUFhLFlBQUFKLENBQUEsQ0FBQUEsQ0FBQSxDQUFJVSxDQUFNLENBQUNFLFNBQ2pELENBQUMsQ0FBQyxDQUNJQyxDQUFZLENBQUduQixtQkFBbUIsQ0FBQyxDQUN4QyxDQUFDUSxDQUFJLEVBQUcsRUFBRSxDQUNWLENBQUNDLENBQVksSUFBUSxDQUNyQixDQUFDQyxDQUFhLEVBQUcsQ0FDbEIsQ0FBQyxDQUFDLENBRUYsTUFBTyxVQUE2RFUsQ0FBc0MsQ0FBRSxLQUFBZCxDQUFBLE1BQ25HZSxDQUFNLENBQVlELENBQU8sQ0FBekJDLE1BQU0sQ0FBRUMsQ0FBSyxDQUFLRixDQUFPLENBQWpCRSxLQUFLLENBUWZDLENBQVMsQ0FBRyxJQUFJLENBQUNDLGVBQWUsQ0FBQ0YsQ0FBSyxDQUFFLENBQUVHLEdBQUcsQ0FBRSxDQUFFLENBQUMsQ0FBb0IsQ0FFNUUsTUFBTyxDQUFBRixDQUFTLENBQUNHLElBQUksQ0FSVSxRQUF6QixDQUFBQyxzQkFBc0JBLENBQUlWLENBQVUsUUFDekMsQ0FBQVcsT0FBTyxDQUFDQyxHQUFHLENBQUMsQ0FDWHpCLENBQVMsRUFBSWlCLENBQU0sQ0FBR2YsQ0FBSSxDQUFDd0IsTUFBTSxDQUFDUixDQUFLLENBQUVELENBQU0sQ0FBQyxDQUFDVSxNQUFNLENBQUMsQ0FBQyxDQUFHekIsQ0FBSSxDQUFDd0IsTUFBTSxDQUFDUixDQUFLLENBQUMsQ0FBQ1MsTUFBTSxDQUFDLENBQUMsQ0FDdkZILE9BQU8sQ0FBQ0ksT0FBTyxDQUFDZixDQUFLLENBQUMsQ0FDdEIsQ0FBQyxDQUl5QyxDQUFDLENBQUNTLElBQUksQ0FBQ2YsQ0FBYSxDQUFDLENBQUNzQixLQUFLLENBQUNkLENBQVksQ0FDckYsQ0FDRCxDQUVBZSxNQUFNLENBQUNDLE9BQU8sQ0FBR2pDLGlCQUFpQiIsImlnbm9yZUxpc3QiOltdfQ==